<html>
<head>
    <meta charset="" UTF-8"">
    <style></style>
    <script>

        function addStyle(selector, base64Rules) {
            try {
                if (typeof selector !== 'string' || typeof base64Rules !== 'string') {
                    throw new Error('Invalid arguments.');
                }

                // Decode the Base64-encoded rules using base64ToUtf8
                const jsonString = base64ToUtf8(base64Rules);
                if (!jsonString) {
                    throw new Error('Decoded rules are empty.');
                }

                const rules = JSON.parse(jsonString);

                // Helper function to convert camelCase to kebab-case
                function camelToKebab(str) {
                    return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
                }

                // Generate CSS rules from the object
                let cssRules = '';
                for (let property in rules) {
                    if (rules.hasOwnProperty(property)) {
                        const cssProperty = camelToKebab(property);
                        cssRules += `${cssProperty}: ${rules[property]};\n`;
                    }
                }

                // Create the complete CSS string
                const css = `${selector} {\n${cssRules}}`;

                // Create a new <style> element
                const styleElement = document.createElement('style');
                styleElement.type = 'text/css';

                // Add the CSS string to the <style> element
                styleElement.appendChild(document.createTextNode(css));

                // Append the <style> element to the <head>
                document.head.appendChild(styleElement);
            } catch (error) {
                // Handle errors
                console.error('Error in addStyle:', error.message);
                navigate('error', '', { message: error.message });
            }
        }
        function addScript(src) {
            // Create a new <script> element
            let scriptElement = document.createElement('script');
            scriptElement.type = 'text/javascript';
            scriptElement.src = src;

            // Append the <script> element to the <head>
            document.head.appendChild(scriptElement);
        }

        // Function to generate a GUID
        function generateGUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0,
                    v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Standard navigation function
        function navigate(componentId, method, args) {
            try {
                if (!componentId || typeof componentId !== 'string') {
                    throw new Error('Invalid componentId.');
                }

                if (method === undefined || typeof method !== 'string') {
                    throw new Error('Invalid method.');
                }

                var differentiator = generateGUID();

                var argsStr = '';
                if (args && typeof args === 'object') {
                    var kvps = Object.entries(args).map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(value)}`).join('&');
                    argsStr = kvps;
                }

                var url = `webcomponent://${componentId}/${method}/${differentiator}`;
                if (argsStr) {
                    url += `?${argsStr}`;
                }

                window.location.href = url;
            } catch (error) {
                // In case of error within navigate, we attempt to navigate to an error URL
                var errorDifferentiator = generateGUID();
                window.location.href = `webcomponent://error//${errorDifferentiator}?message=${encodeURIComponent(error.message)}`;
            }
        }

        function invokeMethod(componentId, methodName, args) {
            try {
                if (!componentId || typeof componentId !== 'string') {
                    throw new Error('Invalid componentId.');
                }
                if (!methodName || typeof methodName !== 'string') {
                    throw new Error('Invalid methodName.');
                }

                // Check if args.target is an "a" element with an "href" attribute
                if (args && args.target && args.target.tagName === 'A' && args.target.href) {
                    const href = args.target.href;

                    // Prevent the default navigation behavior
                    if (typeof args.preventDefault === 'function') {
                        args.preventDefault();
                    }

                    navigate('navigation', 'href', { href: href });
                    return; // Exit the function if redirecting
                }

                navigate(componentId, methodName, args);
            } catch (error) {
                navigate('error', '', { message: error.message });
            }
        }

        window.onscroll = function (ev) {
            try {
                if ((window.innerHeight + window.pageYOffset) >= document.body.offsetHeight - 5) {
                    navigate('scroll', 'bottom', {});
                }
            } catch (error) {
                navigate('error', '', { message: error.message });
            }
        };

        function updateInnerHTML(elementId, base64NewText) {
            try {
                if (!elementId || typeof elementId !== 'string') {
                    throw new Error('Invalid elementId.');
                }
                if (typeof base64NewText !== 'string') {
                    throw new Error('Invalid base64NewText.');
                }
                const element = document.getElementById(elementId);

                if (element) {
                    // Decode the base64-encoded newText
                    var newText = base64ToUtf8(base64NewText);
                    if (!newText) {
                        throw new Error('Decoded newText is empty.');
                    }
                    element.innerHTML = newText;
                } else {
                    throw new Error(`Element with ID "${elementId}" not found.`);
                }
            } catch (error) {
                navigate('error', '', { message: error.message });
            }
        }

        function updateTextNode(elementId, base64NewText) {
            try {
                if (!elementId || typeof elementId !== 'string') {
                    throw new Error('Invalid elementId.');
                }
                if (typeof base64NewText !== 'string') {
                    throw new Error('Invalid base64NewText.');
                }
                const element = document.getElementById(elementId);

                if (element) {
                    // Decode the base64-encoded newText
                    var newText = base64ToUtf8(base64NewText);
                    if (!newText) {
                        throw new Error('Decoded newText is empty.');
                    }
                    let textNodeFound = false;
                    for (let i = 0; i < element.childNodes.length; i++) {
                        const node = element.childNodes[i];
                        if (node.nodeType === Node.TEXT_NODE) {
                            node.nodeValue = newText;
                            textNodeFound = true;
                            break;
                        }
                    }
                    if (!textNodeFound) {
                        // Add a new text node if none are found
                        const textNode = document.createTextNode(newText);
                        element.appendChild(textNode);
                    }
                } else {
                    throw new Error(`Element with ID "${elementId}" not found.`);
                }
            } catch (error) {
                navigate('error', '', { message: error.message });
            }
        }

        function updateElementStyle(elementId, styleKey, value) {
            try {
                if (!elementId || typeof elementId !== 'string') {
                    throw new Error('Invalid elementId.');
                }
                if (!styleKey || typeof styleKey !== 'string') {
                    throw new Error('Invalid styleKey.');
                }
                if (typeof value !== 'string') {
                    throw new Error('Invalid value for style.');
                }

                const element = document.getElementById(elementId);
                if (element) {
                    element.style[styleKey] = value;
                } else {
                    throw new Error(`Element with ID "${elementId}" not found.`);
                }
            } catch (error) {
                navigate('error', '', { message: error.message });
            }
        }

        function base64ToUtf8(base64Str) {
            try {
                if (!base64Str || typeof base64Str !== 'string') {
                    throw new Error('Invalid base64Str.');
                }
                // Decode base64 to bytes
                var binaryStr = atob(base64Str);

                // Convert binary string to an array of bytes
                var bytes = new Uint8Array(binaryStr.length);
                for (var i = 0; i < binaryStr.length; i++) {
                    bytes[i] = binaryStr.charCodeAt(i);
                }

                // Decode bytes to a UTF-8 string
                var decodedStr = new TextDecoder('utf-8').decode(bytes);
                return decodedStr;
            } catch (error) {
                navigate('error', '', { message: 'Error decoding base64 string: ' + error.message });
                return null;
            }
        }

        function addElement(base64Html, index, parentid) {
            try {
                if (!base64Html || typeof base64Html !== 'string') {
                    throw new Error('Invalid base64Html.');
                }
                if (typeof index !== 'number' || index < 0) {
                    throw new Error('Invalid index.');
                }

                var container;
                if (parentid) {
                    container = document.getElementById(parentid);
                    if (!container) {
                        throw new Error(`Parent element with ID "${parentid}" not found.`);
                    }
                } else {
                    container = document.body;
                }

                // Save the current scroll position
                var scrollTop = window.pageYOffset || document.documentElement.scrollTop;

                // Decode the base64-encoded HTML string using UTF-8
                var decodedHtml = base64ToUtf8(base64Html);
                if (!decodedHtml) {
                    throw new Error('Decoded HTML is empty.');
                }

                // Create a temporary container to hold the decoded HTML
                var div = document.createElement('div');
                div.innerHTML = decodedHtml;

                // Create a DocumentFragment to hold the new elements
                var fragment = document.createDocumentFragment();
                var childNodes = Array.from(div.childNodes);
                if (childNodes.length === 0) {
                    throw new Error('Failed to create new elements from decoded HTML.');
                }

                childNodes.forEach(function (node) {
                    fragment.appendChild(node);
                });

                // Insert the fragment at the specified index
                if (index >= container.children.length) {
                    container.appendChild(fragment);
                } else {
                    container.insertBefore(fragment, container.children[index]);
                }

                // Restore the previous scroll position
                window.scrollTo(0, scrollTop);
            } catch (error) {
                navigate('error', '', { message: error.message });
            }
        }

        function removeElement(componentId) {
            try {
                if (!componentId || typeof componentId !== 'string') {
                    throw new Error('Invalid componentId.');
                }
                var element = document.getElementById(componentId);
                if (element) {
                    element.parentNode.removeChild(element);
                } else {
                    throw new Error(`Element with ID "${componentId}" not found.`);
                }
            } catch (error) {
                navigate('error', '', { message: error.message });
            }
        }

        window.onload = function () {
            try {
                navigate('system', 'Loaded', {});
            } catch (error) {
                navigate('error', '', { message: error.message });
            }
        };

        //# sourceURL=head.js
    </script>
</head>
<body id="body">
</body>
</html>